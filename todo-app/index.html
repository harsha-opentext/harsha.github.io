<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Todo App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 12px;">
                <h1>âœ“ Todos</h1>
            </div>
            <div class="search-wrapper">
                <input id="searchInput" class="search-input" type="search" placeholder="Search tasks..." aria-label="Search tasks">
                <button id="clearSearch" class="search-clear" title="Clear search">âœ•</button>
                <button id="tag-filter-btn" class="icon-btn" title="Filter by tag">ğŸ·ï¸</button>
                <button id="clear-tag-filter-btn" class="icon-btn" title="Clear tag filter" style="display:none;margin-left:6px;">âœ–ï¸</button>
                <div id="search-tag-dropdown" class="tag-dropdown" style="display:none; margin-left:8px;"></div>
            </div>
            <div class="header-actions">
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="page-tracker" class="main-content">
        <!-- Add Todo Form -->
        <div class="add-todo-card">
            <input type="text" id="todo-input" placeholder="What needs to be done?" class="todo-input" onkeypress="handleKeyPress(event)">
            <button id="new-info-btn" class="icon-btn" title="Add description">â„¹ï¸</button>
            <button id="new-star-btn" class="star-btn" title="Mark important for new todo">â˜†</button>
            <button class="btn-primary" onclick="addTodo()">Add</button>
        </div>
        <div id="new-desc-wrapper" style="display:none; margin-top:8px; max-width:800px; margin-left:auto; margin-right:auto;">
            <textarea id="new-desc" placeholder="Add an optional description (Markdown supported)..." rows="3" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;"></textarea>
            <div style="display:flex;justify-content:space-between;margin-top:6px;align-items:center;gap:8px;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <button id="render-new-desc" class="icon-btn" title="Render description">Render</button>
                    <div style="color:var(--text-secondary); font-size:13px;">Supports Markdown</div>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <select id="new-expire-select" title="Set expiry (days)" style="min-width:140px;">
                        <option value="">No expiry</option>
                        <option value="1">Expire in 1 day</option>
                        <option value="3">Expire in 3 days</option>
                        <option value="7">Expire in 7 days</option>
                        <option value="14">Expire in 14 days</option>
                    </select>
                    <select id="new-tags-select" style="min-width:160px;"></select>
                    <div style="color:var(--text-secondary); font-size:13px;"><span id="new-desc-count">0</span>/<span id="new-desc-max">2000</span></div>
                </div>
            </div>
        </div>

    <!-- Markdown Render Modal (read-only) -->
    <div id="md-modal" class="md-modal" style="display:none;">
        <div class="md-modal-content">
            <div class="md-modal-header">
                <button id="md-close" class="modal-close">âœ•</button>
            </div>
            <div id="md-body" class="md-modal-body"></div>
        </div>
    </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all" onclick="setFilter('all')">All (<span id="count-all">0</span>)</button>
            <button class="filter-tab" data-filter="active" onclick="setFilter('active')">Active (<span id="count-active">0</span>)</button>
            <button class="filter-tab" data-filter="important" onclick="setFilter('important')">Important (<span id="count-important">0</span>)</button>
            <button class="filter-tab" data-filter="completed" onclick="setFilter('completed')">Done (<span id="count-completed">0</span>)</button>
        </div>

        <!-- Todo List -->
        <div class="todo-list" id="todo-list">
            <!-- Todos will be rendered here -->
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <p>No todos yet</p>
            <p class="empty-subtitle">Add one above to get started!</p>
        </div>
    </main>

    <!-- Admin Page (contains Settings + Logs) -->
    <section id="page-admin" class="page" style="display:none; padding:20px; padding-bottom:calc(96px + var(--safe-area-bottom));">
        <div style="max-width:900px; margin:0 auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h1>Admin</h1>
            </div>

            <div class="settings-section">
                <h3>ğŸ” GitHub Configuration</h3>
                <div class="form-group">
                    <label>Personal Access Token</label>
                    <input type="password" id="cfg-token" placeholder="ghp_..." class="form-input">
                </div>
                <div class="form-group">
                    <label>Repository Path</label>
                    <input type="text" id="cfg-repo" placeholder="username/repo-name" class="form-input">
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                        <input type="checkbox" id="cfg-autosave" style="width: 24px; height: 24px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 600;">ğŸ”„ Auto-Save</div>
                            <div style="font-size: 13px; color: var(--text-secondary); font-weight: normal;">Automatically sync changes to GitHub</div>
                        </div>
                    </label>
                </div>
                <button class="btn-primary" onclick="saveSettings()">ğŸ’¾ Save & Connect</button>
            </div>

            <div class="settings-section">
                <h3>ğŸ”„ Data Management</h3>
                <button class="btn-secondary" onclick="fetchFromGit()">â¬‡ï¸ Fetch from GitHub</button>
                <button class="btn-secondary" onclick="pushToGit()">â¬†ï¸ Push to GitHub</button>
                <button class="btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Clear All Todos</button>
            </div>

            <div class="settings-section">
                <h3>ğŸ” System Logs</h3>
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
                    <select id="log-level" onchange="updateLogLevel()" title="Log Level">
                        <option value="debug">Debug</option>
                        <option value="info" selected>Info</option>
                        <option value="warn">Warn</option>
                        <option value="error">Error</option>
                    </select>
                    <select id="log-retention" onchange="updateRetention()" title="Log Retention">
                        <option value="2">2 min</option>
                        <option value="5" selected>5 min</option>
                        <option value="15">15 min</option>
                        <option value="60">60 min</option>
                        <option value="0">All</option>
                    </select>
                    <button onclick="saveLogs()" class="log-icon-btn" title="Save Logs to GitHub">ğŸ’¾</button>
                    <button onclick="copyLogs()" class="log-icon-btn" title="Copy Logs">ğŸ“‹</button>
                    <button onclick="clearLogs()" class="log-icon-btn" title="Clear Logs">ğŸ—‘ï¸</button>
                </div>
                <div id="log-screen"></div>
            </div>
        </div>
    </section>

    <!-- Customize Page (tags) -->
    <section id="page-customize" class="page" style="display:none; padding:20px; padding-bottom:calc(96px + var(--safe-area-bottom));">
        <div style="max-width:900px; margin:0 auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h1>Customize</h1>
            </div>
            <div class="settings-section">
                <h3>ğŸ·ï¸ Tags</h3>
                <p>Create up to <span id="max-tags-text"></span> tags. Default tag: <strong>in-progress</strong></p>
                <div style="display:flex;gap:8px;align-items:center;">
                    <input id="new-tag-input" class="form-input" placeholder="New tag name" style="flex:1; min-height:40px;" />
                    <button class="btn-primary" id="create-tag-btn">Create</button>
                </div>
                <div style="margin-top:12px;">
                    <button class="btn-secondary" id="clear-all-tags-btn">Clear All Tags</button>
                </div>
                <div id="tags-list" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;"></div>
            </div>
        </div>
    </section>

    <!-- Analytics Page -->
    <section id="page-analytics" class="page" style="display:none; padding:20px; padding-bottom:calc(96px + var(--safe-area-bottom));">
        <div style="max-width:900px; margin:0 auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h1>Analytics</h1>
            </div>

            <div class="chart-container" style="margin-bottom:16px;">
                <h3>Completion</h3>
                <canvas id="analytics-pie" width="300" height="200"></canvas>
            </div>

            <div class="settings-section">
                <h3>ğŸ”” Expiring Soon</h3>
                <div id="expiring-list" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"></div>
                <div style="display:flex;justify-content:center;margin-top:12px;"><button class="btn-secondary" id="view-all-expiring">View All</button></div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
    <script src="app-core.js"></script>
    <script src="storage.js"></script>
    <script src="ui.js"></script>
    <script src="events.js"></script>

    <!-- Bottom Navigation (mobile) -->
    <nav class="main-nav" aria-hidden="false">
        <div class="nav-links">
            <a href="../index.html" class="nav-btn" style="text-decoration:none;">
                <span class="icon">â†</span>
                <span class="label">Apps</span>
            </a>
            <button class="nav-btn" id="nav-tasks" onclick="showPage('main')">
                <span class="icon">âœ…</span>
                <span class="label">Tasks</span>
            </button>
            <button class="nav-btn" id="nav-analytics" onclick="showPage('analytics')">
                <span class="icon">ğŸ“Š</span>
                <span class="label">Analytics</span>
            </button>
            <button class="nav-btn" id="nav-admin" onclick="showPage('admin')">
                <span class="icon">ğŸ”</span>
                <span class="label">Admin</span>
            </button>
            <button class="nav-btn" id="nav-customize" onclick="showPage('customize')">
                <span class="icon">ğŸ§©</span>
                <span class="label">Customize</span>
            </button>
        </div>
    </nav>
</body>
</html>
