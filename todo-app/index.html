<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Todo App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 12px;">
                <a href="../index.html" class="icon-btn" title="Back to Apps" style="text-decoration: none;">â†</a>
                <h1>âœ“ Todos</h1>
            </div>
            <div class="search-wrapper">
                <input id="searchInput" class="search-input" type="search" placeholder="Search tasks..." aria-label="Search tasks">
                <button id="clearSearch" class="search-clear" title="Clear search">âœ•</button>
                <button id="tag-filter-btn" class="icon-btn" title="Filter by tag">ğŸ·ï¸</button>
                <button id="clear-tag-filter-btn" class="icon-btn" title="Clear tag filter" style="display:none;margin-left:6px;">âœ–ï¸</button>
                <div id="search-tag-dropdown" class="tag-dropdown" style="display:none; margin-left:8px;"></div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="fetchFromGit()" title="Fetch from GitHub">â¬‡ï¸</button>
                <button class="icon-btn" onclick="pushToGit()" title="Push to GitHub">ğŸ“¤</button>
                <button class="icon-btn" onclick="toggleLogs()" title="Toggle Logs">ğŸ”</button>
                <button class="icon-btn" id="customize-btn" onclick="showCustomize()" title="Customize">ğŸ§©</button>
                <button class="icon-btn" onclick="showSettings()" title="Settings">âš™ï¸</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Add Todo Form -->
        <div class="add-todo-card">
            <input type="text" id="todo-input" placeholder="What needs to be done?" class="todo-input" onkeypress="handleKeyPress(event)">
            <button id="new-info-btn" class="icon-btn" title="Add description">i</button>
            <button id="new-star-btn" class="star-btn" title="Mark important for new todo">â˜†</button>
            <button class="btn-primary" onclick="addTodo()">Add</button>
        </div>
        <div id="new-desc-wrapper" style="display:none; margin-top:8px; max-width:800px; margin-left:auto; margin-right:auto;">
            <textarea id="new-desc" placeholder="Add an optional description (Markdown supported)..." rows="3" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;"></textarea>
            <div style="display:flex;justify-content:space-between;margin-top:6px;align-items:center;gap:8px;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <button id="render-new-desc" class="icon-btn" title="Render description">Render</button>
                    <div style="color:var(--text-secondary); font-size:13px;">Supports Markdown</div>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <select id="new-tags-select" style="min-width:160px;"></select>
                    <div style="color:var(--text-secondary); font-size:13px;"><span id="new-desc-count">0</span>/<span id="new-desc-max">2000</span></div>
                </div>
            </div>
        </div>

    <!-- Markdown Render Modal (read-only) -->
    <div id="md-modal" class="md-modal" style="display:none;">
        <div class="md-modal-content">
            <div class="md-modal-header">
                <button id="md-close" class="modal-close">âœ•</button>
            </div>
            <div id="md-body" class="md-modal-body"></div>
        </div>
    </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all" onclick="setFilter('all')">All (<span id="count-all">0</span>)</button>
            <button class="filter-tab" data-filter="active" onclick="setFilter('active')">Active (<span id="count-active">0</span>)</button>
            <button class="filter-tab" data-filter="important" onclick="setFilter('important')">Important (<span id="count-important">0</span>)</button>
            <button class="filter-tab" data-filter="completed" onclick="setFilter('completed')">Done (<span id="count-completed">0</span>)</button>
        </div>

        <!-- Todo List -->
        <div class="todo-list" id="todo-list">
            <!-- Todos will be rendered here -->
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <p>No todos yet</p>
            <p class="empty-subtitle">Add one above to get started!</p>
        </div>
    </main>

    <!-- Log Panel (Slide-out) -->
    <aside class="log-panel" id="log-panel" aria-hidden="true">
        <div class="log-header-bar">
            <span>ğŸ” System Logs</span>
            <div class="log-controls">
                <select id="log-level" onchange="updateLogLevel()" title="Log Level">
                    <option value="debug">Debug</option>
                    <option value="info" selected>Info</option>
                    <option value="warn">Warn</option>
                    <option value="error">Error</option>
                </select>
                <select id="log-retention" onchange="updateRetention()" title="Log Retention">
                    <option value="2">2 min</option>
                    <option value="5" selected>5 min</option>
                    <option value="15">15 min</option>
                    <option value="60">60 min</option>
                    <option value="0">All</option>
                </select>
                <button onclick="saveLogs()" class="log-icon-btn" title="Save Logs to GitHub">ğŸ’¾</button>
                <button onclick="copyLogs()" class="log-icon-btn" title="Copy Logs">ğŸ“‹</button>
                <button onclick="clearLogs()" class="log-icon-btn" title="Clear Logs">ğŸ—‘ï¸</button>
                <button onclick="toggleLogs()" class="log-icon-btn" title="Close">âœ•</button>
            </div>
        </div>
        <div id="log-screen"></div>
    </aside>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Settings</h2>
                <button onclick="closeSettings()" class="modal-close">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>ğŸ” GitHub Configuration</h3>
                    <div class="form-group">
                        <label>Personal Access Token</label>
                        <input type="password" id="cfg-token" placeholder="ghp_..." class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Repository Path</label>
                        <input type="text" id="cfg-repo" placeholder="username/repo-name" class="form-input">
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="cfg-autosave" style="width: 24px; height: 24px; cursor: pointer;">
                            <div>
                                <div style="font-weight: 600;">ğŸ”„ Auto-Save</div>
                                <div style="font-size: 13px; color: var(--text-secondary); font-weight: normal;">Automatically sync changes to GitHub</div>
                            </div>
                        </label>
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">ğŸ’¾ Save & Connect</button>
                </div>

                <div class="settings-section">
                    <h3>ğŸ”„ Data Management</h3>
                    <button class="btn-secondary" onclick="fetchFromGit()">â¬‡ï¸ Fetch from GitHub</button>
                    <button class="btn-secondary" onclick="pushToGit()">â¬†ï¸ Push to GitHub</button>
                    <button class="btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Clear All Todos</button>
                </div>

                <div class="settings-section">
                    <h3>ğŸ“± App Info</h3>
                    <p><strong>Version:</strong> 1.0.0</p>
                    <p><strong>Data File:</strong> <code>todos.json</code></p>
                    <p><strong>Total Todos:</strong> <span id="total-todos-count">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Customize Modal (tags) -->
    <div id="customize-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ§© Customize</h2>
                <button onclick="closeCustomize()" class="modal-close">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>ğŸ·ï¸ Tags</h3>
                    <p>Create up to <span id="max-tags-text"></span> tags. Default tag: <strong>in-progress</strong></p>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <input id="new-tag-input" class="form-input" placeholder="New tag name" style="flex:1; min-height:40px;" />
                        <button class="btn-primary" id="create-tag-btn">Create</button>
                    </div>
                    <div style="margin-top:12px;">
                        <button class="btn-secondary" id="clear-all-tags-btn">Clear All Tags</button>
                    </div>
                    <div id="tags-list" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
    <script src="app-core.js"></script>
    <script src="storage.js"></script>
    <script src="ui.js"></script>
    <script src="events.js"></script>
</body>
</html>
